<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gallery</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial; margin: 2rem; line-height: 1.5; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px; }
      figure { margin: 0; }
      img { width: 100%; height: auto; background: #f0f0f0; }
      code { background: #f4f4f4; padding: 0.15rem 0.35rem; border-radius: 4px; }
    </style>
  </head>
  <body>
    <h1>Gallery: JPEG Images</h1>
    <p><a href="/images/">Open /images</a></p>
    <div class="grid" id="grid"></div>
    <script>
      async function listJpegImages() {
        const res = await fetch('/images/');
        const html = await res.text();
        const tmp = document.createElement('div');
        tmp.innerHTML = html;
        const anchors = Array.from(tmp.querySelectorAll('a'));
        const files = anchors.map(a => a.getAttribute('href')).filter(h => h && !h.startsWith('?') && !h.startsWith('/'));
        return files.filter(f => {
          const name = f.toLowerCase();
          return name.endsWith('.jpg') || name.endsWith('.jpeg');
        });
      }

      async function load() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        const files = await listJpegImages();
        files.forEach(file => {
          const img = new Image();
          img.loading = 'eager';
          img.src = '/images/' + file; // no cache-busting param
          const fig = document.createElement('figure');
          fig.appendChild(img);
          grid.appendChild(fig);
        });
      }
      window.addEventListener('DOMContentLoaded', load);
    </script>
  </body>
  </html>

